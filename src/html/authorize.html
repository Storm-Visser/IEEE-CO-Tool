<html>
  <head>
    <script src="https://p.trellocdn.com/power-up.min.js"></script>
    <link rel="stylesheet" href="https://p.trellocdn.com/power-up.min.css" />
    <style>
      select {
        height: 30px;
      }
      * {
        text-align: center;
      }
    </style>
  </head>
  <body>
    <div id="content">
      <p>We need you to authorize first!</p>
      <button id="authorize" type="submit" class="mod-primary">Authorize</button>
    </div>
  </body>
  <script>
    let t = window.TrelloPowerUp.iframe();

    t.render(function () {
      return t.sizeTo("#content");
    });

    const returnUrl = encodeURIComponent('https://relative-due-date.idi.ntnu.no/authorize.html');
    const appKey = 'f8da03ef4e7b8f8ed708470a3680fab2';

    let oauthUrl = `https://trello.com/1/authorize?` +
                    `expiration=never&` +
                    `scope=read,write&` +
                    `key=${appKey}&` +
                    `callback_method=fragment&` +
                    `return_url=${returnUrl}`;

    let authBtn = document.getElementById("authorize");
    authBtn.addEventListener("click", function () {
      t.authorize(oauthUrl)
        .then(function (token) {
          return t.set("member", "private", "authToken", token);
        })
        .then(function () {
          return t.closePopup();
        });
    });
  </script>
</html>
